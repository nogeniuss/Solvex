{"code":"ER_BAD_FIELD_ERROR","errno":1054,"level":"error","message":"Erro ao buscar planos: Unknown column 'plan_id' in 'SELECT'","sql":"\n      SELECT \n        id,\n        plan_id,\n        name,\n        description,\n        price,\n        currency,\n        billing_interval,\n        interval_count,\n        features,\n        is_popular,\n        is_active\n      FROM subscription_plans \n      WHERE is_active = TRUE\n      ORDER BY price ASC\n    ","sqlMessage":"Unknown column 'plan_id' in 'SELECT'","sqlState":"42S22","stack":"Error: Unknown column 'plan_id' in 'SELECT'\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:10:25\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/app/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /app/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/app/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/app/backend/node_modules/express/lib/router/index.js:280:10)","timestamp":"2025-08-20 00:17:46:1746"}
{"code":"ER_BAD_FIELD_ERROR","errno":1054,"level":"error","message":"Erro ao buscar planos: Unknown column 'plan_id' in 'SELECT'","sql":"\n      SELECT \n        id,\n        plan_id,\n        name,\n        description,\n        price,\n        currency,\n        billing_interval,\n        interval_count,\n        features,\n        is_popular,\n        is_active\n      FROM subscription_plans \n      WHERE is_active = TRUE\n      ORDER BY price ASC\n    ","sqlMessage":"Unknown column 'plan_id' in 'SELECT'","sqlState":"42S22","stack":"Error: Unknown column 'plan_id' in 'SELECT'\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:10:25\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/app/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /app/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/app/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/app/backend/node_modules/express/lib/router/index.js:280:10)","timestamp":"2025-08-20 00:35:13:3513"}
{"code":"ER_BAD_FIELD_ERROR","errno":1054,"level":"error","message":"Erro ao buscar planos: Unknown column 'plan_id' in 'SELECT'","sql":"\n      SELECT \n        id,\n        plan_id,\n        name,\n        description,\n        price,\n        currency,\n        billing_interval,\n        interval_count,\n        features,\n        is_popular,\n        is_active\n      FROM subscription_plans \n      WHERE is_active = TRUE\n      ORDER BY price ASC\n    ","sqlMessage":"Unknown column 'plan_id' in 'SELECT'","sqlState":"42S22","stack":"Error: Unknown column 'plan_id' in 'SELECT'\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:10:25\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/app/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /app/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/app/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/app/backend/node_modules/express/lib/router/index.js:280:10)","timestamp":"2025-08-20 00:37:36:3736"}
{"code":"ER_BAD_FIELD_ERROR","errno":1054,"level":"error","message":"Erro ao buscar planos: Unknown column 'plan_id' in 'SELECT'","sql":"\n      SELECT \n        id,\n        plan_id,\n        name,\n        description,\n        price,\n        currency,\n        billing_interval,\n        interval_count,\n        features,\n        is_popular,\n        is_active\n      FROM subscription_plans \n      WHERE is_active = TRUE\n      ORDER BY price ASC\n    ","sqlMessage":"Unknown column 'plan_id' in 'SELECT'","sqlState":"42S22","stack":"Error: Unknown column 'plan_id' in 'SELECT'\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:10:25\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/app/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /app/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/app/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/app/backend/node_modules/express/lib/router/index.js:280:10)","timestamp":"2025-08-20 00:39:37:3937"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:39:4139"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:39:4139"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:39:4139"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:39:4139"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:49:4149"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:49:4149"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:49:4149"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar plano atual do usuário: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:49:4149"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar informações de cobrança: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        u.subscription_status,\n        u.subscription_ends_at,\n        us.current_period_start,\n        us.current_period_end,\n        us.status as subscription_status_detail,\n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(sp.nome, 'Plano Básico') as plan_name,\n        COALESCE(sp.valor, 20.00) as plan_price,\n        COALESCE(sp.moeda, 'BRL') as plan_currency,\n        COALESCE(sp.periodo, 'month') as billing_interval\n      FROM users u\n      LEFT JOIN user_subscriptions us ON u.id = us.user_id\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE u.id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/payment.js:82:28\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:59:4159"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar informações de cobrança: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        u.subscription_status,\n        u.subscription_ends_at,\n        us.current_period_start,\n        us.current_period_end,\n        us.status as subscription_status_detail,\n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(sp.nome, 'Plano Básico') as plan_name,\n        COALESCE(sp.valor, 20.00) as plan_price,\n        COALESCE(sp.moeda, 'BRL') as plan_currency,\n        COALESCE(sp.periodo, 'month') as billing_interval\n      FROM users u\n      LEFT JOIN user_subscriptions us ON u.id = us.user_id\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE u.id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/payment.js:82:28\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:59:4159"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar informações de cobrança: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        u.subscription_status,\n        u.subscription_ends_at,\n        us.current_period_start,\n        us.current_period_end,\n        us.status as subscription_status_detail,\n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(sp.nome, 'Plano Básico') as plan_name,\n        COALESCE(sp.valor, 20.00) as plan_price,\n        COALESCE(sp.moeda, 'BRL') as plan_currency,\n        COALESCE(sp.periodo, 'month') as billing_interval\n      FROM users u\n      LEFT JOIN user_subscriptions us ON u.id = us.user_id\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE u.id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/payment.js:82:28\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:59:4159"}
{"code":"ER_NO_SUCH_TABLE","errno":1146,"level":"error","message":"Erro ao buscar informações de cobrança: Table 'financas.user_subscriptions' doesn't exist","sql":"\n      SELECT \n        u.subscription_status,\n        u.subscription_ends_at,\n        us.current_period_start,\n        us.current_period_end,\n        us.status as subscription_status_detail,\n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(sp.nome, 'Plano Básico') as plan_name,\n        COALESCE(sp.valor, 20.00) as plan_price,\n        COALESCE(sp.moeda, 'BRL') as plan_currency,\n        COALESCE(sp.periodo, 'month') as billing_interval\n      FROM users u\n      LEFT JOIN user_subscriptions us ON u.id = us.user_id\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE u.id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Table 'financas.user_subscriptions' doesn't exist","sqlState":"42S02","stack":"Error: Table 'financas.user_subscriptions' doesn't exist\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/payment.js:82:28\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:41:59:4159"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:46:32:4632"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:46:32:4632"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:46:32:4632"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:46:32:4632"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:47:33:4733"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:47:33:4733"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:47:33:4733"}
{"code":"ER_CANT_AGGREGATE_2COLLATIONS","errno":1267,"level":"error","message":"Erro ao buscar plano atual do usuário: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sql":"\n      SELECT \n        COALESCE(us.plan_id, 'basic') as plan_id,\n        COALESCE(us.status, 'incomplete') as status,\n        us.current_period_start,\n        us.current_period_end,\n        COALESCE(sp.nome, 'Plano Básico') as name,\n        COALESCE(sp.valor, 20.00) as price,\n        COALESCE(sp.moeda, 'BRL') as currency,\n        COALESCE(sp.periodo, 'month') as billing_interval,\n        sp.features\n      FROM user_subscriptions us\n      LEFT JOIN subscription_plans sp ON us.plan_id = sp.id\n      WHERE us.user_id = ?\n      ORDER BY us.created_at DESC\n      LIMIT 1\n    ","sqlMessage":"Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='","sqlState":"HY000","stack":"Error: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='\n    at PromisePool.execute (/app/backend/node_modules/mysql2/lib/promise/pool.js:54:22)\n    at query (/app/backend/database.js:44:31)\n    at /app/backend/routes/plans.js:102:36\n    at Layer.handle [as handle_request] (/app/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/app/backend/node_modules/express/lib/router/route.js:149:13)\n    at /app/backend/routes/auth.js:20:5\n    at /app/backend/node_modules/jsonwebtoken/verify.js:261:12\n    at getSecret (/app/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/app/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at authenticateToken (/app/backend/routes/auth.js:15:7)","timestamp":"2025-08-20 00:47:33:4733"}
